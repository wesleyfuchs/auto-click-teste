PrimeFaces.widget.DataTable=function(d,a){this.id=d;this.cfg=a;this.jqId=PrimeFaces.escapeClientId(d);this.tbody=this.jqId+"_data";if(this.cfg.paginator){this.setupPaginator()}this.setupSortEvents();if(this.cfg.selectionMode||this.cfg.columnSelectionMode){this.selectionHolder=this.jqId+"_selection";var b=jQuery(this.selectionHolder).val();this.selection=b==""?[]:b.split(",");this.setupSelectionEvents()}if(this.cfg.expansion){this.setupExpansionEvents()}if(this.cfg.scrollable){this.setupScrolling()}var c=this.getRowEditors();if(c.length>0){this.setupCellEditorEvents(c)}};PrimeFaces.widget.DataTable.prototype.setupPaginator=function(){var a=this.getPaginator();a.subscribe("changeRequest",this.paginate,null,this);a.render()};PrimeFaces.widget.DataTable.prototype.setupSortEvents=function(){var a=this;jQuery(this.jqId+" th.ui-sortable-column").mouseover(function(){jQuery(this).toggleClass("ui-state-hover")}).mouseout(function(){jQuery(this).toggleClass("ui-state-hover")}).click(function(b){if(jQuery(b.target).is(":not(th,span)")){return}var c=jQuery(this).attr("id");jQuery(this).siblings().removeClass("ui-state-active").children(".ui-sortable-column-icon").removeClass("ui-icon-triangle-1-n ui-icon-triangle-1-s");jQuery(this).addClass("ui-state-active");var d=jQuery(this).children(".ui-sortable-column-icon");if(d.hasClass("ui-icon-triangle-1-n")){d.removeClass("ui-icon-triangle-1-n").addClass("ui-icon-triangle-1-s");a.sort(c,false)}else{if(d.hasClass("ui-icon-triangle-1-s")){d.removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-n");a.sort(c,true)}else{d.addClass("ui-icon-triangle-1-n");a.sort(c,true)}}})};PrimeFaces.widget.DataTable.prototype.setupSelectionEvents=function(){var b=this;if(this.cfg.selectionMode){var c=this.cfg.dblclickSelect?"dblclick":"click",a=this.isCellSelectionEnabled()?this.jqId+" tbody.ui-datatable-data tr td":this.jqId+" tbody.ui-datatable-data tr";jQuery(a).css("cursor","pointer").die().live("mouseover",function(){var d=jQuery(this);if(!d.hasClass("ui-selected")){d.addClass("ui-state-highlight")}}).live("mouseout",function(){var d=jQuery(this);if(!d.hasClass("ui-selected")){d.removeClass("ui-state-highlight")}}).live(c,function(d){if(this.nodeName=="TR"){b.onRowClick(d,this)}else{b.onCellClick(d,this)}})}else{if(this.cfg.columnSelectionMode){if(this.cfg.columnSelectionMode=="single"){jQuery(this.jqId+" tbody.ui-datatable-data td.ui-selection-column input:radio").die().live("click",function(){b.selectRowWithRadio(this)})}else{jQuery(this.jqId+" tbody.ui-datatable-data td.ui-selection-column input:checkbox").die().live("click",function(){b.selectRowWithCheckbox(this)})}}}};PrimeFaces.widget.DataTable.prototype.setupExpansionEvents=function(){var a=this;jQuery(this.jqId+" tbody.ui-datatable-data tr td span.ui-row-toggler").die().live("click",function(){a.toggleExpansion(this)})};PrimeFaces.widget.DataTable.prototype.setupScrolling=function(){var e=jQuery(this.jqId+" .ui-datatable-scrollable-body"),d=e.get(0),b=jQuery(this.tbody).get(0);var c=(d.scrollHeight>d.clientHeight)?(b.parentNode.clientWidth+16)+"px":(b.parentNode.clientWidth-1)+"px";jQuery(this.jqId).css("width",c);if(this.cfg.liveScroll){this.scrollOffset=this.cfg.scrollStep;this.shouldLiveScroll=true;var a=this;e.scroll(function(){if(a.shouldLiveScroll){var f=jQuery(this);var i=f.attr("scrollTop"),h=f.attr("scrollHeight"),g=f.attr("clientHeight");if(i>=(h-(g))){a.loadLiveRows()}}})}};PrimeFaces.widget.DataTable.prototype.loadLiveRows=function(){var b={source:this.id,process:this.id,update:this.id,formId:this.cfg.formId},a=this;b.onsuccess=function(h){var f=h.documentElement,g=f.getElementsByTagName("update");for(var d=0;d<g.length;d++){var j=g[d].attributes.getNamedItem("id").nodeValue,e=g[d].firstChild.data;if(j==a.id){jQuery(a.jqId+" .ui-datatable-scrollable-body table tr:last").after(e);a.scrollOffset+=a.cfg.scrollStep;if(a.scrollOffset==a.cfg.scrollLimit){a.shouldLiveScroll=false}}else{PrimeFaces.ajax.AjaxUtils.updateElement(j,e)}}return false};var c={};c[this.id+"_scrolling"]=true;c[this.id+"_scrollOffset"]=this.scrollOffset;PrimeFaces.ajax.AjaxRequest(this.cfg.url,b,c)};PrimeFaces.widget.DataTable.prototype.paginate=function(c){var b={source:this.id,update:this.id,process:this.id,formId:this.cfg.formId};var a=this;b.onsuccess=function(j){var g=j.documentElement,h=g.getElementsByTagName("update");for(var e=0;e<h.length;e++){var k=h[e].attributes.getNamedItem("id").nodeValue,f=h[e].firstChild.data;if(k==a.id){jQuery(a.tbody).replaceWith(f);a.getPaginator().setState(c)}else{PrimeFaces.ajax.AjaxUtils.updateElement(k,f)}}return false};var d={};d[this.id+"_paging"]=true;d[this.id+"_first"]=c.recordOffset;d[this.id+"_rows"]=c.rowsPerPage;d[this.id+"_page"]=c.page;PrimeFaces.ajax.AjaxRequest(this.cfg.url,b,d)};PrimeFaces.widget.DataTable.prototype.sort=function(d,c){if(this.isSelectionEnabled()){this.clearSelection()}var b={source:this.id,update:this.id,process:this.id,formId:this.cfg.formId};var a=this;b.onsuccess=function(k){var h=k.documentElement,j=h.getElementsByTagName("update");for(var f=0;f<j.length;f++){var m=j[f].attributes.getNamedItem("id").nodeValue,g=j[f].firstChild.data;if(m==a.id){jQuery(a.tbody).replaceWith(g);var l=a.getPaginator();if(l){l.setPage(1,true)}}else{PrimeFaces.ajax.AjaxUtils.updateElement(m,g)}}return false};var e={};e[this.id+"_sorting"]=true;e[this.id+"_sortKey"]=d;e[this.id+"_sortDir"]=c;PrimeFaces.ajax.AjaxRequest(this.cfg.url,b,e)};PrimeFaces.widget.DataTable.prototype.filter=function(){if(this.isSelectionEnabled()){this.clearSelection()}var b={source:this.id,update:this.id,process:this.id,formId:this.cfg.formId};var a=this;b.onsuccess=function(k){var m=k.documentElement,j=m.getElementsByTagName("update");var l=a.getPaginator();if(l){var h=m.getElementsByTagName("extension"),g=a.getPaginator().getTotalRecords();for(var e=0;e<h.length;e++){if(h[e].attributes.getNamedItem("primefacesCallbackParam").nodeValue=="totalRecords"){g=jQuery.parseJSON(h[e].firstChild.data).totalRecords;l.setPage(1,true);l.setTotalRecords(g,true)}}}for(e=0;e<j.length;e++){var d=j[e].attributes.getNamedItem("id").nodeValue,f=j[e].firstChild.data;if(d==a.id){jQuery(a.tbody).replaceWith(f)}else{PrimeFaces.ajax.AjaxUtils.updateElement(d,f)}}return false};var c={};c[this.id+"_filtering"]=true;PrimeFaces.ajax.AjaxRequest(this.cfg.url,b,c)};PrimeFaces.widget.DataTable.prototype.onRowClick=function(b,a){if(jQuery(b.target).is("td,span")){var c=jQuery(a);if(c.hasClass("ui-selected")){this.unselectRow(c)}else{this.selectRow(c)}}};PrimeFaces.widget.DataTable.prototype.selectRow=function(b){var a=b.attr("id").split("_row_")[1];if(this.isSingleSelection()){b.siblings(".ui-selected").removeClass("ui-selected ui-state-highlight");this.selection=[]}b.addClass("ui-state-highlight ui-selected");this.selection.push(a);this.writeSelections();if(this.cfg.instantSelect){this.fireRowSelectEvent(a)}};PrimeFaces.widget.DataTable.prototype.unselectRow=function(b){var a=b.attr("id").split("_row_")[1];b.removeClass("ui-selected ui-state-highlight");this.selection=jQuery.grep(this.selection,function(c){return c!=a});this.writeSelections();if(this.cfg.instantUnselect){this.fireRowUnselectEvent(a)}};PrimeFaces.widget.DataTable.prototype.fireRowSelectEvent=function(b){var a={source:this.id,process:this.id,formId:this.cfg.formId};if(this.cfg.onRowSelectUpdate){a.update=this.cfg.onRowSelectUpdate}if(this.cfg.onRowSelectStart){a.onstart=this.cfg.onRowSelectStart}if(this.cfg.onRowSelectComplete){a.oncomplete=this.cfg.onRowSelectComplete}var c={};c[this.id+"_instantSelectedRowIndex"]=b;PrimeFaces.ajax.AjaxRequest(this.cfg.url,a,c)};PrimeFaces.widget.DataTable.prototype.fireRowUnselectEvent=function(b){var a={source:this.id,process:this.id,formId:this.cfg.formId};if(this.cfg.onRowUnselectUpdate){a.update=this.cfg.onRowUnselectUpdate}var c={};c[this.id+"_instantUnselectedRowIndex"]=b;PrimeFaces.ajax.AjaxRequest(this.cfg.url,a,c)};PrimeFaces.widget.DataTable.prototype.selectRowWithRadio=function(a){var c=jQuery(a).parent().parent(),b=c.attr("id").split("_row_")[1];this.selection=[];this.selection.push(b);this.writeSelections()};PrimeFaces.widget.DataTable.prototype.selectRowWithCheckbox=function(a){var c=jQuery(a),e=c.parent().parent(),d=e.attr("id").split("_row_")[1],b=c.attr("checked");if(b){this.selection.push(d)}else{this.selection=jQuery.grep(this.selection,function(f){return f!=d})}this.writeSelections()};PrimeFaces.widget.DataTable.prototype.toggleCheckAll=function(c){var e=jQuery(c),d=e.attr("checked");this.clearSelection();if(d){jQuery(this.jqId+" tbody.ui-datatable-data td.ui-selection-column input:checkbox").attr("checked",true);if(this.getPaginator()!=null){for(var b=0;b<this.getPaginator().getTotalRecords();b++){this.selection.push(b)}}else{var a=this;jQuery(this.jqId+" tbody.ui-datatable-data tr").each(function(){a.selection.push(jQuery(this).attr("id").split("_row_")[1])})}}else{jQuery(this.jqId+" tbody.ui-datatable-data td.ui-selection-column input:checkbox").attr("checked",false)}this.writeSelections()};PrimeFaces.widget.DataTable.prototype.onCellClick=function(c,b){if(jQuery(c.target).is("td,span")){var a=jQuery(b);if(a.hasClass("ui-selected")){this.unselectCell(a)}else{this.selectCell(a)}}};PrimeFaces.widget.DataTable.prototype.selectCell=function(a){var c=a.parent().attr("id").split("_row_")[1],b=a.index();if(this.cfg.selectionMode==="singlecell"){jQuery(this.jqId+" tbody.ui-datatable-data td").removeClass("ui-selected ui-state-highlight");this.selection=[]}a.addClass("ui-state-highlight ui-selected");this.selection.push(c+"#"+b);this.writeSelections()};PrimeFaces.widget.DataTable.prototype.unselectCell=function(a){var d=a.parent().attr("id").split("_row_")[1],b=a.index(),c=d+"#"+b;a.removeClass("ui-selected ui-state-highlight");this.selection=jQuery.grep(this.selection,function(e){return e!=c});this.writeSelections()};PrimeFaces.widget.DataTable.prototype.toggleExpansion=function(b){var d=jQuery(b),c=d.parent().parent(),a=c.hasClass("ui-expanded-row");if(a){d.removeClass("ui-icon-circle-triangle-s");c.removeClass("ui-expanded-row");c.next().fadeOut(function(){jQuery(this).remove()})}else{d.addClass("ui-icon-circle-triangle-s");c.addClass("ui-expanded-row");this.loadExpandedRowContent(c)}};PrimeFaces.widget.DataTable.prototype.loadExpandedRowContent=function(e){if(this.cfg.onExpandStart){this.cfg.onExpandStart.call(this,e)}var b={source:this.id,process:this.id,update:this.id,formId:this.cfg.formId},c=e.attr("id").split("_row_")[1],a=this;b.onsuccess=function(k){var h=k.documentElement,j=h.getElementsByTagName("update");for(var f=0;f<j.length;f++){var l=j[f].attributes.getNamedItem("id").nodeValue,g=j[f].firstChild.data;if(l==a.id){e.after(g);e.next().fadeIn()}else{PrimeFaces.ajax.AjaxUtils.updateElement(l,g)}}return false};var d={};d[this.id+"_rowExpansion"]=true;d[this.id+"_expandedRowId"]=c;PrimeFaces.ajax.AjaxRequest(this.cfg.url,b,d)};PrimeFaces.widget.DataTable.prototype.showEditors=function(a){jQuery(a).parents("tr:first").addClass("ui-state-highlight").children("td.ui-editable-column").each(function(){var b=jQuery(this);b.find("span.ui-cell-editor-output").hide();b.find("span.ui-cell-editor-input").show();jQuery(a).hide();jQuery(a).siblings().show()})};PrimeFaces.widget.DataTable.prototype.saveRowEdit=function(a){this.doRowEditRequest(a,"save")};PrimeFaces.widget.DataTable.prototype.cancelRowEdit=function(a){this.doRowEditRequest(a,"cancel")};PrimeFaces.widget.DataTable.prototype.doRowEditRequest=function(c,b){var h=jQuery(jQuery(c).parents("tr").get(0)),i={source:this.id,update:this.id,formId:this.cfg.formId},g=this,d=h.find("span.ui-row-editor").attr("id"),e=h.hasClass("ui-expanded-row");if(b==="save"){var f=new Array();f.push(d);h.find("span.ui-cell-editor").each(function(){f.push(jQuery(this).attr("id"))});i.process=f.join(" ");if(this.cfg.onRowEditUpdate){i.update+=" "+this.cfg.onRowEditUpdate}}i.onsuccess=function(q){var s=q.documentElement,o=s.getElementsByTagName("update"),n=s.getElementsByTagName("extension");this.args={};for(k=0;k<n.length;k++){var p=n[k];if(p.getAttributeNode("primefacesCallbackParam")){var r=jQuery.parseJSON(p.firstChild.data);for(var l in r){if(l){this.args[l]=r[l]}}}}for(var k=0;k<o.length;k++){var j=o[k].attributes.getNamedItem("id").nodeValue,m=o[k].firstChild.data;if(j==g.id){if(!this.args.validationFailed){if(e){h.next().remove()}h.replaceWith(m)}}else{PrimeFaces.ajax.AjaxUtils.updateElement(j,m)}}return false};var a={};a[d]=d;a[this.id+"_rowEdit"]=true;a[this.id+"_editedRowId"]=h.attr("id").split("_row_")[1];PrimeFaces.ajax.AjaxRequest(this.cfg.url,i,a)};PrimeFaces.widget.DataTable.prototype.getPaginator=function(){return this.cfg.paginator};PrimeFaces.widget.DataTable.prototype.writeSelections=function(){jQuery(this.selectionHolder).val(this.selection.join(","))};PrimeFaces.widget.DataTable.prototype.isSingleSelection=function(){return this.cfg.selectionMode=="single"};PrimeFaces.widget.DataTable.prototype.clearSelection=function(){this.selection=[];jQuery(this.selectionHolder).val("")};PrimeFaces.widget.DataTable.prototype.isSelectionEnabled=function(){return this.cfg.selectionMode!=undefined||this.cfg.columnSelectionMode!=undefined};PrimeFaces.widget.DataTable.prototype.isCellSelectionEnabled=function(){return this.cfg.selectionMode==="singlecell"||this.cfg.selectionMode==="multiplecell"};PrimeFaces.widget.DataTable.prototype.getRowEditors=function(){return jQuery(this.jqId+" tbody.ui-datatable-data tr td span.ui-row-editor")};PrimeFaces.widget.DataTable.prototype.setupCellEditorEvents=function(b){var a=this;b.find("span.ui-icon-pencil").die().live("click",function(){a.showEditors(this)});b.find("span.ui-icon-check").die().live("click",function(){a.saveRowEdit(this)});b.find("span.ui-icon-close").die().live("click",function(){a.cancelRowEdit(this)})};PrimeFaces.widget.DataTable.prototype.clearFilters=function(){jQuery(this.jqId+" thead th .ui-column-filter").val("");var a={source:this.id,update:this.id,process:this.id,formId:this.cfg.formId};var b={};b[this.id+"_clearFilters"]=true;PrimeFaces.ajax.AjaxRequest(this.cfg.url,a,b)};